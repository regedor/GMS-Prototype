<script>
jQuery.noConflict();

jQuery(document).ready(function($) {

	var values = $("#mail_mailable").val().split(',')
	function split( val ) 
	{
		return val.split( /,\s*/ );
	}
	function extractLast( term ) 
	{
		return split( term ).pop();
	}
	
    
	$( "#mail_recipients" ).bind( "keydown", function( event ) 
	{
			if ( event.keyCode === $.ui.keyCode.TAB && $( this ).data( "autocomplete" ).menu.active ) 
	 	{
	 		event.preventDefault();
	 	}	
	 }).autocomplete(
	 	{
	 		minLength: 0,
	 		source: function( request, response ) 
	 		{
	 			// delegate back to autocomplete, but extract the last term
	 			response( $.ui.autocomplete.filter(values, extractLast( request.term )));
	 		},
	 		focus: function() 
	 		{
	 			// prevent value inserted on focus
	 			return false;
	 		},
	 		select: function( event, ui ) 
	 		{
	 			var terms = split( this.value );
	 			// remove the current input
	 			terms.pop();
	 			// add the selected item
	 			terms.push( ui.item.value );
	 			// add placeholder to get the comma-and-space at the end
	 			terms.push( "" );
	 			this.value = terms.join( ", " );
	 			return false;
	 		}
	 	});
	});
</script>

<% form_for @mail, :url=>admin_mails_path, :method=>"post" do |f| -%>
  To:      <%= text_field_tag :mail_recipients, "", :size => 30 %><br/> 
  Subject: <%= f.text_field :subject %><br/>
  Message: <%= f.text_area :message %><br/>	
  <%= f.hidden_field(:mailable) %>

  <%= f.submit "Send email" %>
<% end -%>

<% if File.exists?(Rails.root.join("app", "views", params[:controller], "_sidebar.html.erb")) %>
  <% content_for :sidebar do -%>
    <%= render :partial => 'sidebar'  %>
  <% end -%>
<% end -%>