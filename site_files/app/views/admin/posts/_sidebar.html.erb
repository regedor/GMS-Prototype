<% i_env = "admin.posts.tags" -%>
<div class="block">
  <h3>
    <%= I18n::t("#{i_env}.title") %>
    <% if @tags.total_pages > 1 -%>
      <%= will_paginate(@tags, :previous_label => I18n::t("#{i_env}.pagination.previous"),
                               :next_label     => I18n::t("#{i_env}.pagination.next"),
                               :param_name     => :tag_page) %>
    <% end -%>
  </h3>

  <div class="content">
    <ul class="list">
      <% @tags.each do |tag| %>
      <li id="tag-<%= tag.id %>" class="<%= 'selected' if @tag_ids.include? tag.id.to_s %>">
        <%= tag.name %>
        (<%= link_to(
               I18n::t("#{i_env}.list.posts." + (tag.taggings_count == 1 ? "one" : "more"), :count => tag.taggings_count),
               admin_posts_path(:tag_ids => @tag_ids, :this_tag_id => tag.id)
             )
        %>)
        <a class="float-right" href="<%= edit_tag_admin_post_path(tag) %>" onclick='edit_tag_js(<%= tag.id %>, "<%= tag.name %>"); return false;'>
           <%= I18n::t("#{i_env}.list.edit") %>
        </a>
      </li>
      <% end %>
    </ul>
  </div>
</div>

<script type="text/javascript">
  function edit_tag_js(id, old_name) {
    var new_name = prompt(<%= '"' + I18n::t("#{i_env}.edit.prompt") + '"' %> + ' "' + old_name + '"', "");
    if (new_name != null) {
      jQuery.ajax({
        type: "PUT",
        url: "posts/" + id + "/update_tag",
        data: "tag[name]=" + new_name,
        success: function(xmlhttp) {
          eval(xmlhttp);
        }
      });
    }
  }

  function update_record(id, old_name, new_name) {
    var old_line = document.getElementById("tag-" + id).innerHTML;
    var new_line = old_line.replace(new RegExp(old_name + "[ \n]+"), new_name + " ");
    new_line = new_line.replace('"' + old_name + '"', '"' + new_name + '"');
    document.getElementById("tag-" + id).innerHTML = new_line;
  }
</script>
