<% content_for(:page_title) do %>
  <%= posts_title(@tag) %>
<% end -%>

<% content_for :head do %>
  <%= auto_discovery_link_tag(:atom, @tag.nil? ? posts_path(:format => 'atom') : posts_path(:tag => @tag, :format => 'atom')) %>
  <%= javascript_include_tag "announcements" %>
  <% javascript_tag do %>
    window.onload = setTimeout(function() { announcementsRoutine(<%= @announcements.size %>) }, 0);
  <% end %>
<% end %>

<div id="announcements">
  <% if(@announcements.size > 0) %>
    <div id="announcements-bar">
      <% @announcements.each_with_index do |announcement,i| -%>
        <%= link_to announcement.title, announcement_path(announcement), :onmouseover => "changeAnnouncement(#{i})" %>
        <%= "|" unless i+1 == @announcements.size %>
      <% end -%>
    </div>
    <div id="announcements-area">
      <%= render :partial => 'announcement', :collection => @announcements %>
    </div>
  <% else %>
    <p>There are no current announcements!</p>
  <% end %>
</div>

<div id="posts">
  <% if @posts.empty? -%>
    <p>There are no posts yet.</p>
  <% else -%>
    <% @posts.each do |post| -%>
      <div class="post post-<%= post.id %>">
        <%= render :partial => 'post', :locals => {:post => post} %>
      </div>
    <% end -%>
    <% if more_content? -%>
      <div class="related">Looking for more? Head on over to the <%= link_to("archives", archives_path) %>.</div>
    <% end -%>
  <% end -%>
</div>
