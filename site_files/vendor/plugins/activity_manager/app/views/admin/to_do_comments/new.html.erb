<% content_for(:head) do -%>
  <%= javascript_include_tag 'edit_preview' %>
<% end -%>

<div class="content">
  <div class="header">	
    <h2><%= t("admin.to_do.comment.title", :list => @todo.to_do_list.name) %></h2>
    <% classStr = (@todo.done? ? "done" : "not-done") %>
    <div id="todo" class="<%= classStr %>">
      <span class="due-date"><%= l(@todo.due_date, :format => :medium) %></span>
      <span class="responsible"><%= @todo.user.name %></span>:
      <span class="description"><%= @todo.description %></span>
    </div>
  </div>
  <hr />
  <div id="comments">
    <% @todo.comments.each do |comment| %>
      <div id="comment-<%= comment.id %>" class="comment">
	  <div class="avatar"><%= image_tag avatar_url(comment.user,:size => :small) %></div>
	  <% classStr = (comment.user == current_user) ? "comments_meta highlight" : "comments_meta" %>
	  <div class="<%= classStr %>">
		<span class="name"><%= comment.user.name %></span>
		<span class="date"><%= l(comment.created_at, :format => :default) %></span>
	  </div>
	  <span class="text">
            <%= comment.body_html %>
          </span>
      </div>
      <hr />
    <% end %>
  </div>
  <div class="new-comment">
	<% semantic_form_for @comment, :url => admin_project_to_do_comments_path(params[:project_id],@todo.id), :html => {:method => :post} do |f| %>
	  <% f.inputs do %>
	    <%= f.input :body, :as => :text, :label => t("admin.to_do_comment.new.body") %>
	    <%= f.input :users, :as => :check_boxes, :collection => @project.users, :label => t("admin.to_do_comment.new.users"), :required => false %>
	  <% end  %>
	  <% f.buttons do %>
            <%= f.commit_button :label => t('admin.to_do_comment.new.create_button'),
                                :button_html => { :class => 'button positive' } %>
	    <%= f.button_link t('admin.to_do_comment.new.preview_button'), '#new_to_do_comment',
                              :button_html => { :class => 'button positive preview' }  %>
	    <%= f.button_link t('admin.to_do_comment.new.edit_button'), '#new_to_do_comment',
			      :button_html => { :class => 'button positive edit' }  %>
	    <%= f.button_link t('admin.to_do_comment.new.cancel'), admin_project_to_do_lists_path(params[:project_id]),
			      :button_html => { :class => 'button negative' }  %>
          <% end %>
   <% end %>
  </div>
</div>
